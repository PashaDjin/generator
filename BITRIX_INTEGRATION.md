# üîó –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ë–∏—Ç—Ä–∏–∫—Å24

## üìã –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ
1. [–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç](#–∫–∞–∫-—ç—Ç–æ-—Ä–∞–±–æ—Ç–∞–µ—Ç)
2. [–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Google Apps Script](#–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-google-apps-script)
3. [–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ë–∏—Ç—Ä–∏–∫—Å24](#–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-–±–∏—Ç—Ä–∏–∫—Å24)
4. [–§–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö](#—Ñ–æ—Ä–º–∞—Ç-–¥–∞–Ω–Ω—ã—Ö)
5. [–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ](#—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
6. [–ü–æ–ª—è –≤ –ë–∏—Ç—Ä–∏–∫—Å–µ](#–ø–æ–ª—è-–≤-–±–∏—Ç—Ä–∏–∫—Å–µ)

---

## üîÑ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         POST –∑–∞–ø—Ä–æ—Å          ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  –ë–∏—Ç—Ä–∏–∫—Å24  ‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>  ‚îÇ  Google Apps     ‚îÇ
‚îÇ   (–°–¥–µ–ª–∫–∞)  ‚îÇ   {bitrixDealId, client,     ‚îÇ     Script       ‚îÇ
‚îÇ             ‚îÇ    address, phone}            ‚îÇ                  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                               ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
      ‚ñ≤                                              ‚îÇ
      ‚îÇ                                              ‚îÇ ID —Å–¥–µ–ª–∫–∏ ‚Üí UID
      ‚îÇ                                              ‚îÇ –°–æ–∑–¥–∞—ë—Ç:
      ‚îÇ                                              ‚îÇ ‚Ä¢ –ü–∞–ø–∫—É –∫–ª–∏–µ–Ω—Ç–∞
      ‚îÇ                                              ‚îÇ ‚Ä¢ –°–º–µ—Ç—É (–∫–æ–ø–∏—è)
      ‚îÇ                                              ‚îÇ ‚Ä¢ –í—ã–¥–∞—ë—Ç –¥–æ—Å—Ç—É–ø—ã
      ‚îÇ       –û—Ç–≤–µ—Ç —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º                    ‚îÇ ‚Ä¢ –û–±–Ω–æ–≤–ª—è–µ—Ç –û–ë–™–ï–ö–¢–´
      ‚îÇ    {uid, smetaUrl, folderUrl}                ‚îÇ
      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ü—Ä–æ—Ü–µ—Å—Å:
1. **–ë–∏—Ç—Ä–∏–∫—Å** –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ: ID —Å–¥–µ–ª–∫–∏, –∫–ª–∏–µ–Ω—Ç, –∞–¥—Ä–µ—Å, —Ç–µ–ª–µ—Ñ–æ–Ω
2. **GAS** –∏—Å–ø–æ–ª—å–∑—É–µ—Ç ID —Å–¥–µ–ª–∫–∏ –∫–∞–∫ UID (—Ñ–æ—Ä–º–∞—Ç: `BITRIX-12345`)
3. **GAS** —Å–æ–∑–¥–∞—ë—Ç —Å–º–µ—Ç—É, –ø–∞–ø–∫—É, –≤—ã–¥–∞—ë—Ç –¥–æ—Å—Ç—É–ø—ã
4. **GAS** –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ–±—Ä–∞—Ç–Ω–æ –≤ –ë–∏—Ç—Ä–∏–∫—Å: —Å—Å—ã–ª–∫–∏ –Ω–∞ —Å–º–µ—Ç—É/–ø–∞–ø–∫—É
5. **–ë–∏—Ç—Ä–∏–∫—Å** –æ–±–Ω–æ–≤–ª—è–µ—Ç –ø–æ–ª—è —Å–¥–µ–ª–∫–∏ –ø–æ–ª—É—á–µ–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏

**–í–ê–ñ–ù–û:** –ì–µ–Ω–µ—Ä–∞—Ü–∏—è UID —á–µ—Ä–µ–∑ —Å—á—ë—Ç—á–∏–∫ –±–æ–ª—å—à–µ –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è! UID = ID —Å–¥–µ–ª–∫–∏ –ë–∏—Ç—Ä–∏–∫—Å–∞.

---

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Google Apps Script

### 0. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û!)

–û—Ç–∫—Ä–æ–π —Ç–∞–±–ª–∏—Ü—É –∏ –∑–∞–ø–æ–ª–Ω–∏ –ª–∏—Å—Ç **"–¢–µ—Ö"**:

| –Ø—á–µ–π–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|----------|----------|
| **L2** | ID —à–∞–±–ª–æ–Ω–∞ —Å–º–µ—Ç—ã | ID —Ñ–∞–π–ª–∞ –≤ Google Drive (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ!) |
| **L3** | –ë–†–ï–ù–î-–ú–ê–† / –°–¢–†–û–ô–ú–ê–¢ | –Æ—Ä–ª–∏—Ü–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é |
| **L4** | –ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω | –ú–µ–Ω–µ–¥–∂–µ—Ä –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é |
| **L5** | –ü–µ—Ç—Ä–æ–≤ –ü–µ—Ç—Ä | –ó–∞–º–µ—Ä—â–∏–∫ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é |
| **L6** | 1abc...xyz | ID –ø–∞–ø–∫–∏ –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –≤ Drive (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ!) |
| **L7** | measurer@example.com | Email –∑–∞–º–µ—Ä—â–∏–∫–∞ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ!) |

**–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è (L2, L6, L7)** –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞–ø–æ–ª–Ω–µ–Ω—ã, –∏–Ω–∞—á–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Å–º–µ—Ç—ã –Ω–µ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å!

### 1. –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–¥–∞

–í–µ—Å—å –∫–æ–¥ —É–∂–µ –≤ –ø—Ä–æ–µ–∫—Ç–µ:
- `7_WebhookBitrix.js` ‚Äî –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤–µ–±—Ö—É–∫–æ–≤

### 2. –î–µ–ø–ª–æ–π –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

#### –ß–µ—Ä–µ–∑ clasp (–∫–æ–º–∞–Ω–¥–Ω–∞—è —Å—Ç—Ä–æ–∫–∞):
```bash
clasp push
clasp deploy --description "Bitrix24 Integration v1"
```

#### –ß–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å:
1. –û—Ç–∫—Ä–æ–π –ø—Ä–æ–µ–∫—Ç: https://script.google.com/home
2. –ù–∞–π–¥–∏ –ø—Ä–æ–µ–∫—Ç –ø–æ ID: `1EQiHV_ehdInMzIPRz_SKw63gvD0_XTwqHsGHCQdmsh6RSWjFU_fOwXwI`
3. –ù–∞–∂–º–∏ **"–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å"** ‚Üí **"–ù–æ–≤–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ"**
4. –í—ã–±–µ—Ä–∏ —Ç–∏–ø: **"–í–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ"**
5. –ù–∞—Å—Ç—Ä–æ–π–∫–∏:
   - **–û–ø–∏—Å–∞–Ω–∏–µ**: `Bitrix24 Webhook`
   - **–ó–∞–ø—É—Å–∫ –æ—Ç –∏–º–µ–Ω–∏**: `–Ø`
   - **–£ –∫–æ–≥–æ –µ—Å—Ç—å –¥–æ—Å—Ç—É–ø**: `–í—Å–µ`
6. –ù–∞–∂–º–∏ **"–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å"**
7. **–°–ö–û–ü–ò–†–£–ô URL** ‚Äî –æ–Ω –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –¥–ª—è –ë–∏—Ç—Ä–∏–∫—Å–∞

**–§–æ—Ä–º–∞—Ç URL:**
```
https://script.google.com/macros/s/{DEPLOY_ID}/exec
```

**–í–ê–® –¢–ï–ö–£–©–ò–ô URL:**
```
https://script.google.com/macros/s/AKfycbyjJDkB9_8W8rQKhADQXllx9doq82rFl5o2GUOt_qECzdk_HIyaoY5uJtbACW4A1RzE/exec
```

---

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ë–∏—Ç—Ä–∏–∫—Å24

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –ø–æ–ª–µ–π

–ü–µ—Ä–µ–π–¥–∏: **CRM ‚Üí –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –ø–æ–ª—è ‚Üí –°–¥–µ–ª–∫–∞**

–°–æ–∑–¥–∞–π —Å–ª–µ–¥—É—é—â–∏–µ –ø–æ–ª—è:

| –ù–∞–∑–≤–∞–Ω–∏–µ –ø–æ–ª—è | –°–∏–º–≤–æ–ª—å–Ω—ã–π –∫–æ–¥ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------------|----------------|-----|----------|
| UID —Å–º–µ—Ç—ã | `UF_CRM_SMETA_UID` | –°—Ç—Ä–æ–∫–∞ | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –æ–±—ä–µ–∫—Ç–∞ |
| –°—Å—ã–ª–∫–∞ –Ω–∞ —Å–º–µ—Ç—É | `UF_CRM_SMETA_LINK` | –°—Å—ã–ª–∫–∞ | URL —Ñ–∞–π–ª–∞ —Å–º–µ—Ç—ã |
| ID —Ñ–∞–π–ª–∞ —Å–º–µ—Ç—ã | `UF_CRM_SMETA_ID` | –°—Ç—Ä–æ–∫–∞ | Google Drive File ID |
| –ü–∞–ø–∫–∞ –∫–ª–∏–µ–Ω—Ç–∞ | `UF_CRM_FOLDER_LINK` | –°—Å—ã–ª–∫–∞ | URL –ø–∞–ø–∫–∏ –≤ Drive |

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏—Å—Ö–æ–¥—è—â–µ–≥–æ –≤–µ–±—Ö—É–∫–∞

#### A. –°–æ–∑–¥–∞–Ω–∏–µ –≤–µ–±—Ö—É–∫–∞ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –í GAS

1. –ü–µ—Ä–µ–π–¥–∏: **–ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è ‚Üí –í–µ–±—Ö—É–∫–∏ ‚Üí –ò—Å—Ö–æ–¥—è—â–∏–π –≤–µ–±—Ö—É–∫**
2. –ù–∞–∂–º–∏ **"+ –î–æ–±–∞–≤–∏—Ç—å –≤–µ–±—Ö—É–∫"**
3. –ù–∞—Å—Ç—Ä–æ–π–∫–∏:
   - **–ù–∞–∑–≤–∞–Ω–∏–µ**: `–°–æ–∑–¥–∞–Ω–∏–µ —Å–º–µ—Ç—ã –≤ GAS`
   - **URL –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞**: `{–°–ö–û–ü–ò–†–û–í–ê–ù–ù–´–ô URL –ò–ó GAS}`
   - **–°–æ–±—ã—Ç–∏–µ**: `–ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–¥–µ–ª–∫–∏` (ONCRMDEALUPDATE)
   - **–§–∏–ª—å—Ç—Ä**: –°—Ç–∞–¥–∏—è = "–î–µ–ª–∞–µ–º —Å–º–µ—Ç—É"
4. –°–æ—Ö—Ä–∞–Ω–∏

#### B. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö

–í –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –≤–µ–±—Ö—É–∫–∞ —É–∫–∞–∂–∏ **—Ç–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞ (JSON)**:

```json
{
  "bitrixDealId": "{=Document:ID}",
  "client": "{=Document:TITLE}",
  "address": "{=Document:UF_CRM_ADDRESS}",
  "phone": "{=Document:PHONE[0].VALUE}",
  "bitrixWebhookUrl": "https://your-domain.bitrix24.ru/rest/1/{YOUR_WEBHOOK_TOKEN}/"
}
```

**–í–ê–ñ–ù–û:** –ó–∞–º–µ–Ω–∏:
- `your-domain` ‚Äî –Ω–∞ —Ç–≤–æ–π –ø–æ–¥–¥–æ–º–µ–Ω –ë–∏—Ç—Ä–∏–∫—Å24
- `{YOUR_WEBHOOK_TOKEN}` ‚Äî –Ω–∞ —Ç–≤–æ–π —Ç–æ–∫–µ–Ω –≤—Ö–æ–¥—è—â–µ–≥–æ –≤–µ–±—Ö—É–∫–∞ (—Å–º. –Ω–∏–∂–µ)

**–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ** (–µ—Å–ª–∏ —Ö–æ—á–µ—à—å –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞):
```json
{
  "bitrixDealId": "{=Document:ID}",
  "client": "{=Document:TITLE}",
  "address": "{=Document:UF_CRM_ADDRESS}",
  "phone": "{=Document:PHONE[0].VALUE}",
  
  "company": "{=Document:ASSIGNED_BY_ID.UF_DEPARTMENT}",
  "manager": "{=Document:ASSIGNED_BY_ID.NAME} {=Document:ASSIGNED_BY_ID.LAST_NAME}",
  "measurer": "{=Document:UF_CRM_MEASURER}",
  "managerFolderId": "{=Document:ASSIGNED_BY_ID.UF_DRIVE_FOLDER}",
  "measurerEmail": "{=Document:UF_CRM_MEASURER_EMAIL}",
  "templateId": "{=Template:SMETA_TEMPLATE_ID}",
  
  "bitrixWebhookUrl": "https://your-domain.bitrix24.ru/rest/1/{YOUR_WEBHOOK_TOKEN}/"
}
```

#### C. –°–æ–∑–¥–∞–Ω–∏–µ –≤—Ö–æ–¥—è—â–µ–≥–æ –≤–µ–±—Ö—É–∫–∞ (–¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–∞)

1. –ü–µ—Ä–µ–π–¥–∏: **–ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è ‚Üí –í–µ–±—Ö—É–∫–∏ ‚Üí –í—Ö–æ–¥—è—â–∏–π –≤–µ–±—Ö—É–∫**
2. –ù–∞–∂–º–∏ **"+ –î–æ–±–∞–≤–∏—Ç—å –≤–µ–±—Ö—É–∫"**
3. –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞:
   - ‚úÖ `crm` (CRM)
   - ‚úÖ `crm.deal.update` (–ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å–¥–µ–ª–æ–∫)
4. –°–∫–æ–ø–∏—Ä—É–π **URL –≤–µ–±—Ö—É–∫–∞** (—Ñ–æ—Ä–º–∞—Ç: `https://your-domain.bitrix24.ru/rest/1/abc123xyz/`)
5. –≠—Ç–æ—Ç URL —É–∫–∞–∂–∏ –≤ –ø–æ–ª–µ `bitrixWebhookUrl` (—Å–º. –≤—ã—à–µ)

---

## üì¶ –§–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö

### –ó–∞–ø—Ä–æ—Å –û–¢ –ë–∏—Ç—Ä–∏–∫—Å–∞ –í GAS

**–ú–ò–ù–ò–ú–ê–õ–¨–ù–´–ô –Ω–∞–±–æ—Ä (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è):**
```json
{
  "bitrixDealId": "12345",
  "client": "–°–∏–¥–æ—Ä–æ–≤ –ê–Ω–¥—Ä–µ–π",
  "address": "–ú–æ—Å–∫–≤–∞, —É–ª. –õ–µ–Ω–∏–Ω–∞, –¥. 10, –∫–≤. 5",
  "phone": "89991112233",
  "bitrixWebhookUrl": "https://your-domain.bitrix24.ru/rest/1/webhook_code/"
}
```

**–í–ê–ñ–ù–û:** 
- `bitrixDealId` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ UID (—Ñ–æ—Ä–º–∞—Ç: `BITRIX-12345`)
- –û—Å—Ç–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–∫–æ–º–ø–∞–Ω–∏—è, –º–µ–Ω–µ–¥–∂–µ—Ä, –∑–∞–º–µ—Ä—â–∏–∫, –ø–∞–ø–∫–∞, —à–∞–±–ª–æ–Ω) –±–µ—Ä—É—Ç—Å—è –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞ (–ª–∏—Å—Ç "–¢–µ—Ö")

**–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–æ–ª—è** (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥):
```json
{
  "bitrixDealId": "12345",
  "client": "–°–∏–¥–æ—Ä–æ–≤ –ê–Ω–¥—Ä–µ–π",
  "address": "–ú–æ—Å–∫–≤–∞, —É–ª. –õ–µ–Ω–∏–Ω–∞, –¥. 10, –∫–≤. 5",
  "phone": "89991112233",
  
  "company": "–°–¢–†–û–ô–ú–ê–¢",
  "manager": "–î—Ä—É–≥–æ–π –ú–µ–Ω–µ–¥–∂–µ—Ä",
  "measurer": "–î—Ä—É–≥–æ–π –ó–∞–º–µ—Ä—â–∏–∫",
  "managerFolderId": "1XYZ...ABC",
  "measurerEmail": "another@example.com",
  "templateId": "1GHI...DEF",
  
  "bitrixWebhookUrl": "https://your-domain.bitrix24.ru/rest/1/webhook_code/"
}
```

### –û—Ç–≤–µ—Ç –û–¢ GAS –í –ë–∏—Ç—Ä–∏–∫—Å

```json
{
  "success": true,
  "data": {
    "uid": "BITRIX-12345",
    "bitrixDealId": "12345",
    "smetaUrl": "https://docs.google.com/spreadsheets/d/1ABC.../edit",
    "smetaId": "1ABC...XYZ",
    "folderUrl": "https://drive.google.com/drive/folders/1DEF...GHI",
    "action": "CREATE_NEW",
    "status": "–î–µ–ª–∞–µ–º —Å–º–µ—Ç—É",
    "message": "–°–º–µ—Ç–∞ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–∞. UID: BITRIX-12345"
  }
}
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–¥–µ–ª–∫–∏ –≤ –ë–∏—Ç—Ä–∏–∫—Å–µ

GAS –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç –ø–æ–ª—è:
- `UF_CRM_SMETA_UID` = `"BITRIX-12345"`
- `UF_CRM_SMETA_LINK` = `"https://docs.google.com/..."`
- `UF_CRM_SMETA_ID` = `"1ABC...XYZ"`
- `UF_CRM_FOLDER_LINK` = `"https://drive.google.com/..."`
- `COMMENTS` = `"–°–º–µ—Ç–∞ —Å–æ–∑–¥–∞–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏. UID: BITRIX-12345"`

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç —á–µ—Ä–µ–∑ Apps Script Editor

1. –û—Ç–∫—Ä–æ–π —Ñ–∞–π–ª `7_WebhookBitrix.js`
2. –ù–∞–π–¥–∏ —Ñ—É–Ω–∫—Ü–∏—é `testWebhook()`
3. –ó–∞–º–µ–Ω–∏ —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ:
   - `managerFolderId` ‚Äî ID –ø–∞–ø–∫–∏ –≤ Google Drive
   - `templateId` ‚Äî ID —à–∞–±–ª–æ–Ω–∞ —Å–º–µ—Ç—ã
4. –ó–∞–ø—É—Å—Ç–∏ —Ñ—É–Ω–∫—Ü–∏—é —á–µ—Ä–µ–∑ —Ä–µ–¥–∞–∫—Ç–æ—Ä
5. –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏: `View ‚Üí Logs` (Ctrl+Enter)

### –¢–µ—Å—Ç —á–µ—Ä–µ–∑ Postman

**URL:** `{–°–ö–û–ü–ò–†–û–í–ê–ù–ù–´–ô URL –ò–ó GAS}`

**–ú–µ—Ç–æ–¥:** `POST`

**Headers:**
```
Content-Type: application/json
```

**Body (–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π):**
```json
{
  "bitrixDealId": "12345",
  "client": "–¢–µ—Å—Ç–æ–≤—ã–π –ö–ª–∏–µ–Ω—Ç",
  "address": "–ú–æ—Å–∫–≤–∞, —É–ª. –¢–µ—Å—Ç–æ–≤–∞—è, –¥. 1",
  "phone": "89991112233",
  "bitrixWebhookUrl": "https://your-domain.bitrix24.ru/rest/1/webhook/"
}
```

**–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç (200 OK):**
```json
{
  "success": true,
  "data": {
    "uid": "BITRIX-12345",
    "bitrixDealId": "12345",
    "smetaUrl": "https://docs.google.com/...",
    "smetaId": "1ABC...",
    "folderUrl": "https://drive.google.com/...",
    "action": "CREATE_NEW",
    "status": "–î–µ–ª–∞–µ–º —Å–º–µ—Ç—É",
    "message": "–°–º–µ—Ç–∞ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–∞. UID: BITRIX-12345"
  }
}
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –ë–∏—Ç—Ä–∏–∫—Å–µ

1. –û—Ç–∫—Ä–æ–π —Å–¥–µ–ª–∫—É
2. –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –ø–æ–ª—è –æ–±–Ω–æ–≤–∏–ª–∏—Å—å:
   - ‚úÖ **UID —Å–º–µ—Ç—ã**: –∑–∞–ø–æ–ª–Ω–µ–Ω–æ
   - ‚úÖ **–°—Å—ã–ª–∫–∞ –Ω–∞ —Å–º–µ—Ç—É**: –∫–ª–∏–∫–∞–±–µ–ª—å–Ω–∞
   - ‚úÖ **–ü–∞–ø–∫–∞ –∫–ª–∏–µ–Ω—Ç–∞**: –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è
3. –ü–µ—Ä–µ–π–¥–∏ –ø–æ —Å—Å—ã–ª–∫–µ –Ω–∞ —Å–º–µ—Ç—É ‚Äî –¥–æ–ª–∂–µ–Ω –æ—Ç–∫—Ä—ã—Ç—å—Å—è —Ñ–∞–π–ª

---

## üìù –ü–æ–ª—è –≤ –ë–∏—Ç—Ä–∏–∫—Å–µ

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –¥–ª—è –û–¢–ü–†–ê–í–ö–ò –≤ GAS:

| –ü–æ–ª–µ –ë–∏—Ç—Ä–∏–∫—Å–∞ | –°–∏–º–≤–æ–ª—å–Ω—ã–π –∫–æ–¥ | –ü—Ä–∏–º–µ—Ä |
|--------------|----------------|--------|
| **ID —Å–¥–µ–ª–∫–∏** | `ID` | "12345" |
| **–ù–∞–∑–≤–∞–Ω–∏–µ —Å–¥–µ–ª–∫–∏** | `TITLE` | "–°–∏–¥–æ—Ä–æ–≤ –ê–Ω–¥—Ä–µ–π" |
| **–ê–¥—Ä–µ—Å** | `UF_CRM_ADDRESS` | "–ú–æ—Å–∫–≤–∞, —É–ª. –õ–µ–Ω–∏–Ω–∞, –¥. 10" |
| **–¢–µ–ª–µ—Ñ–æ–Ω** | `PHONE[0].VALUE` | "89991112233" |

**–û—Å—Ç–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ** (–∫–æ–º–ø–∞–Ω–∏—è, –º–µ–Ω–µ–¥–∂–µ—Ä, –∑–∞–º–µ—Ä—â–∏–∫, –ø–∞–ø–∫–∞, —à–∞–±–ª–æ–Ω) –±–µ—Ä—É—Ç—Å—è –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞ (–ª–∏—Å—Ç "–¢–µ—Ö" ‚Üí L2-L7).

### –û–±–Ω–æ–≤–ª—è—é—Ç—Å—è –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è —Å–º–µ—Ç—ã:

| –ü–æ–ª–µ | –°–∏–º–≤–æ–ª—å–Ω—ã–π –∫–æ–¥ | –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è |
|------|----------------|-------------|
| UID —Å–º–µ—Ç—ã | `UF_CRM_SMETA_UID` | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ |
| –°—Å—ã–ª–∫–∞ –Ω–∞ —Å–º–µ—Ç—É | `UF_CRM_SMETA_LINK` | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ |
| ID —Ñ–∞–π–ª–∞ —Å–º–µ—Ç—ã | `UF_CRM_SMETA_ID` | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ |
| –ü–∞–ø–∫–∞ –∫–ª–∏–µ–Ω—Ç–∞ | `UF_CRM_FOLDER_LINK` | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ |

---

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

1. **–û–≥—Ä–∞–Ω–∏—á—å –¥–æ—Å—Ç—É–ø –∫ –≤–µ–±—Ö—É–∫–∞–º** ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π IP-—Ñ–∏–ª—å—Ç—Ä—ã
2. **–ü—Ä–æ–≤–µ—Ä—è–π —Ç–æ–∫–µ–Ω—ã** ‚Äî –¥–æ–±–∞–≤—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é –≤ `doPost()`
3. **–õ–æ–≥–∏—Ä—É–π –∑–∞–ø—Ä–æ—Å—ã** ‚Äî –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
4. **–û–≥—Ä–∞–Ω–∏—á—å –ø—Ä–∞–≤–∞** ‚Äî –≤–µ–±—Ö—É–∫ –¥–æ–ª–∂–µ–Ω –æ–±–Ω–æ–≤–ª—è—Ç—å —Ç–æ–ª—å–∫–æ —Å–¥–µ–ª–∫–∏

### –ü—Ä–∏–º–µ—Ä –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞:

```javascript
function doPost(e) {
  const SECRET_TOKEN = 'your_secret_token_here';
  
  try {
    const payload = JSON.parse(e.postData.contents);
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞
    if (payload.token !== SECRET_TOKEN) {
      throw new Error('–ù–µ–≤–µ—Ä–Ω—ã–π —Ç–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø–∞');
    }
    
    // ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥
  } catch (error) {
    // ...
  }
}
```

---

## üêõ –û—Ç–ª–∞–¥–∫–∞

### –õ–æ–≥–∏ –≤ Apps Script:
```javascript
Logger.log('–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö: ' + JSON.stringify(payload));
```

–ü—Ä–æ—Å–º–æ—Ç—Ä: **View ‚Üí Logs** (Ctrl+Enter)

### –õ–æ–≥–∏ –≤ –ë–∏—Ç—Ä–∏–∫—Å–µ:
**–ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è ‚Üí –í–µ–±—Ö—É–∫–∏ ‚Üí –ò—Å—Ç–æ—Ä–∏—è –≤—ã–∑–æ–≤–æ–≤**

–ó–¥–µ—Å—å –≤–∏–¥–Ω—ã:
- ‚úÖ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
- ‚úÖ –ü–æ–ª—É—á–µ–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã
- ‚ùå –û—à–∏–±–∫–∏

### –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:

| –ü—Ä–æ–±–ª–µ–º–∞ | –ü—Ä–∏—á–∏–Ω–∞ | –†–µ—à–µ–Ω–∏–µ |
|----------|---------|---------|
| 401 Unauthorized | –ù–µ–≤–µ—Ä–Ω—ã–π URL –¥–µ–ø–ª–æ—è | –ü–µ—Ä–µ—Å–æ–∑–¥–∞–π —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ |
| 500 Internal Error | –û—à–∏–±–∫–∞ –≤ –∫–æ–¥–µ GAS | –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ Apps Script |
| –ë–∏—Ç—Ä–∏–∫—Å –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è | –ù–µ–≤–µ—Ä–Ω—ã–π —Ç–æ–∫–µ–Ω –≤–µ–±—Ö—É–∫–∞ | –ü—Ä–æ–≤–µ—Ä—å `bitrixWebhookUrl` |
| –ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–º–µ—Ç–µ | –ù–µ–≤–µ—Ä–Ω—ã–π email | –ü—Ä–æ–≤–µ—Ä—å `measurerEmail` |

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö –ø—Ä–æ–≤–µ—Ä—å:
1. –õ–æ–≥–∏ Apps Script: [script.google.com](https://script.google.com)
2. –ò—Å—Ç–æ—Ä–∏—é –≤–µ–±—Ö—É–∫–æ–≤ –≤ –ë–∏—Ç—Ä–∏–∫—Å–µ
3. –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –ø–∞–ø–∫–∞–º/—Ñ–∞–π–ª–∞–º –≤ Google Drive

**ID –ø—Ä–æ–µ–∫—Ç–∞ GAS:** `1EQiHV_ehdInMzIPRz_SKw63gvD0_XTwqHsGHCQdmsh6RSWjFU_fOwXwI`
